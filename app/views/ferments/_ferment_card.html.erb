<div class="f-card">
  <div class="f-card-img">
    <% if ferment.photos.attached? %>
      <%= image_tag ferment.photos.first.variant(resize_to_fill: [400, 250]), class: "img-fluid",loading: "lazy" %>
    <% else %>
      <%= image_tag "https://res.cloudinary.com/dk4bh7tkl/image/upload/v1768395316/plachodeer_sqjar9.jpg", class: "img-fluid opacity-25" %>
    <% end %>

    <div class="f-badge <%= ferment.needs_review? ? 'ready' : 'waiting' %>">
      <%= ferment.needs_review? ? 'LISTO' : "#{ferment.days_left}d restan" %>
    </div>
  </div>

  <div class="f-card-content">
    <div class="d-flex justify-content-between align-items-start mb-2">
      <%= link_to ferment.name, ferment_path(ferment), class: "f-title text-decoration-none", data: { turbo_frame: "_top" } %>
      <% if ferment.comments.size > 0 %>
        <span class="text-secondary small"><i class="bi bi-chat"></i> <%= ferment.comments.size %></span>
      <% end %>
    </div>

    <p class="f-ingredients"><%= ferment.ingredients %></p>


    <div class="f-card-footer">
      <% owner = ferment.user %>
      <%= link_to profile_path(owner), class: "f-user", data: { turbo_frame: "_top" } do %>
        <% if owner.photo.attached? %>
          <%= image_tag (owner.photo.attached? ? owner.photo : "https://via.placeholder.com/30"), class: "f-avatar" %>
          <span>@<%= owner.full_name.split.first %></span>
        <% end %>
      <% end %>

      <div class="f-actions">
        <%= link_to ferment_path(ferment), class: "btn-view", data: { turbo_frame: "_top" } do %>
          <i class="bi bi-eye"></i>
        <% end %>
        <% if owner == current_user %>
          <%= link_to user_ferment_path(current_user, ferment), data: { turbo_method: :delete }, class: "btn-delete" do %>
            <i class="bi bi-trash"></i>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>
