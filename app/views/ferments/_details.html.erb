<section class="ferment-details p-4 mb-5 rounded-3 shadow-sm bg-white">

  <div class="fermentation-progress-container mb-4 p-3 border rounded bg-light">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h6 class="mb-0 fw-bold text-uppercase small tracking-wider">Estado de fermentaciÃ³n</h6>
      <span class="badge <%= ferment.needs_review? ? 'bg-danger animate-pulse' : 'bg-success' %>">
        <%= ferment.needs_review? ? 'âš ï¸ Toca revisar' : 'En curso' %>
      </span>
    </div>

    <%
      bar_class = "bg-success"
      bar_class = "bg-warning" if ferment.progress_percentage > 70
      bar_class = "bg-danger" if ferment.needs_review?
    %>

    <div class="progress mb-2" style="height: 25px; border-radius: 10px;">
      <div class="progress-bar progress-bar-striped progress-bar-animated <%= bar_class %>"
           role="progressbar"
           style="width: <%= ferment.progress_percentage %>%"
           aria-valuenow="<%= ferment.progress_percentage %>"
           aria-valuemin="0"
           aria-valuemax="100">
        <span class="fw-bold"><%= ferment.progress_percentage %>%</span>
      </div>
    </div>

    <div class="d-flex justify-content-between mt-1">
      <small class="text-muted">Inicio: <%= ferment.formatted_start_date %></small>
      <small class="fw-bold <%= 'text-danger' if ferment.needs_review? %>">
      <% if ferment.needs_review? %>
        Â¡Pasado por <%= ferment.days_passed - ferment.revisar_fermentos %> dÃ­as!
      <% else %>
        Faltan <%= ferment.days_left %> dÃ­as para revisarlo
      <% end %>
      </small>
      <% if ferment.needs_review? && current_user == ferment.user %>
        <%= link_to restart_ferment_path(ferment),
                      data: { turbo_method: :patch },
                      class: "btn btn-outline-success fw-bold" do %>
            <i class="bi bi-arrow-repeat"></i> Reiniciar
        <% end %>
      <% end %>
    </div>
  </div>



  <%
    details = {
      "ðŸ“– DescripciÃ³n" => simple_format(ferment.description),
      "ðŸ§‚ Ingredientes" => simple_format(ferment.ingredients),
      "ðŸ“‹ Instrucciones" => simple_format(ferment.instructions),
      "â° Tiempo total" => "#{ferment.revisar_fermentos} dÃ­as"
    }
  %>

  <div class="mt-3">
    <% details.each do |label, value| %>
      <div class="mb-3">
        <strong class="d-block mb-1 text-secondary text-uppercase small" style="letter-spacing: 1px;">
          <%= label %>
        </strong>
        <div class="ps-2 border-start border-3 border-light">
          <%= value %>
        </div>
      </div>
    <% end %>
  </div>

  <% if current_user?(ferment.user) %>
    <%= link_to "Editar fermento ðŸ› ï¸", edit_user_ferment_path(current_user, ferment), class:"btn btn-outline-warning btn-sm w-25 w-md-auto" %>
  <% end %>

  <div id="photos-container-<%= ferment.id %>">
    <% if ferment.photos.any? %>
      <div class="border-top my-4">
        <p class="text-muted text-center my-3" id="photo-count-<%= ferment.id %>">
          ðŸ“¸ <%= ferment.photos.count %> fotos del proceso
        </p>
        <%= render "ferments/photo_ferments", ferment: ferment %>
      </div>
    <% else %>
      <%= render "ferments/empty_photos" %>
    <% end %>
  </div>

</section>
