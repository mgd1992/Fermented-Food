<section class="f-details-card mb-5">
  <div class="f-progress-banner p-4 rounded-top-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <span class="status-pill <%= ferment.needs_review? ? 'urgent' : 'active' %>">
        <i class="bi <%= ferment.needs_review? ? 'bi-exclamation-triangle-fill' : 'bi-clock-history' %> me-2"></i>
        <%= ferment.needs_review? ? 'TOCA REVISAR' : 'FERMENTANDO' %>
      </span>

      <% if current_user == ferment.user %>
        <%= link_to edit_user_ferment_path(current_user, ferment), class: "btn-edit-circle" do %>
          <i class="bi bi-pencil"></i>
        <% end %>
      <% end %>
    </div>

    <div class="progress-wrapper mb-3">
      <div class="progress custom-progress" style="height: 12px;">
        <div class="progress-bar progress-bar-striped progress-bar-animated <%= ferment.needs_review? ? 'bg-danger' : 'bg-warning' %>"
             style="width: <%= ferment.progress_percentage %>%"></div>
      </div>
      <div class="d-flex justify-content-between mt-2 small">
        <span class="text-secondary">Inicio: <%= ferment.formatted_start_date %></span>
        <span class="text-warning fw-bold"><%= ferment.progress_percentage %>% completado</span>
      </div>
    </div>

    <% if ferment.needs_review? && current_user == ferment.user %>
      <%= link_to restart_ferment_path(ferment), data: { turbo_method: :patch }, class: "btn btn-warning w-100 fw-bold rounded-pill py-2" do %>
        <i class="bi bi-arrow-repeat me-2"></i> REINICIAR CICLO
      <% end %>
    <% end %>
  </div>

  <div class="p-4">
    <div class="row g-4">
      <% [
        { label: "üìñ Descripci√≥n", val: ferment.description, icon: "bi-info-circle" },
        { label: "üßÇ Ingredientes", val: ferment.ingredients, icon: "bi-egg-fried" },
        { label: "üìã Instrucciones", val: ferment.instructions, icon: "bi-journal-text" }
      ].each do |item| %>
        <div class="col-12">
          <label class="text-secondary text-uppercase small fw-bold mb-2 d-block">
            <i class="<%= item[:icon] %> text-warning me-2"></i><%= item[:label] %>
          </label>
          <div class="text-light-gray ps-4 border-start border-secondary opacity-75">
            <%= simple_format(item[:val]) %>
          </div>
        </div>
      <% end %>
    </div>

    <div id="photos-container-<%= ferment.id %>" class="mt-5 pt-4 border-top border-secondary border-opacity-25">
      <% if ferment.photos.any? %>
        <h6 class="text-center text-secondary small mb-4">üì∏ GALER√çA DEL PROCESO (<%= ferment.photos.count %>)</h6>
        <%= render "ferments/photo_ferments", ferment: ferment %>
      <% else %>
        <%= render "ferments/empty_photos" %>
      <% end %>
    </div>
  </div>
</section>
