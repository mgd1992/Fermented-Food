<div class="index-layout">
  <div class="container-fluid px-3 px-lg-5">

    <header class="index-header mb-4">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
        <div>
          <h1 class="text-white fw-bold h2 mb-1">Comunidad <span class="text-warning">Cool Beans</span></h1>
          <p class="text-secondary small mb-0">Explora procesos de fermentación activos</p>
        </div>
        <% if user_signed_in? %>
          <%= link_to new_user_ferment_path(current_user), class: "btn btn-warning btn-sm rounded-pill px-4 fw-bold shadow-sm" do %>
            <i class="bi bi-plus-lg me-1"></i> NUEVO
          <% end %>
        <% end %>
      </div>
    </header>

    <%= turbo_frame_tag "ferments_filter_frame" do %>

      <div class="toolbar-box mb-4">
        <div class="search-area">
          <%= form_with url: ferments_path, method: :get, class: "w-100", data: { turbo_frame: "ferments_filter_frame" } do %>
            <div class="search-input-group">
              <i class="bi bi-search text-secondary"></i>
              <%= text_field_tag :query, params[:query], placeholder: "Buscar...", class: "clean-input" %>
              <%= hidden_field_tag :status, params[:status] if params[:status].present? %>
            </div>
          <% end %>
        </div>

        <div class="filter-area">
          <%= link_to "Todos", ferments_path(query: params[:query]), class: "chip #{'active' if params[:status].blank?}" %>
          <%= link_to "⏳ En curso", ferments_path(status: :active, query: params[:query]), class: "chip #{'active' if params[:status] == 'active'}" %>
          <%= link_to "✅ Listos", ferments_path(status: :ready, query: params[:query]), class: "chip #{'active' if params[:status] == 'ready'}" %>
        </div>
      </div>

      <div class="ferments-grid">
        <%= render partial: "ferments/ferment_card", collection: @ferments, as: :ferment %>
      </div>

      <% if @ferments.total_pages > 1 %>
        <div class="pagination-wrapper mt-5">
          <%= paginate @ferments %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
