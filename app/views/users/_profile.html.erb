<div class="profile text-center text-light bg-dark p-4 rounded-4 mb-4 shadow-lg border border-secondary border-opacity-25">
  <div class="profile-header-mobile d-flex flex-column align-items-center">
    <% if user.photo.attached? %>
      <%= image_tag user.photo.variant(resize_to_fill: [150, 150]), class: "img-fluid rounded-circle mb-3 border border-3 border-warning border-opacity-50 profile-pic" %>
    <% else %>
      <div class="placeholder-img rounded-circle bg-secondary mb-3 d-flex align-items-center justify-content-center" style="width: 120px; height: 120px;">
        <i class="bi bi-person fs-1"></i>
      </div>
    <% end %>

    <div class="profile-info">
      <h3 class="text-light mt-2 mb-0 fw-bold"><%= user.full_name %></h3>
      <p class="text-secondary small mb-2"><%= user.email %></p>
      <span class="badge rounded-pill bg-warning text-dark px-3 py-2 fw-bold">
        <%= user.ferments.count %> Fermentos
      </span>
    </div>
  </div>

  <div class="profile-actions d-grid gap-2 mt-4">
    <% if user_signed_in? && user == current_user %>
      <%= link_to 'Crear Fermento', new_user_ferment_path(current_user), class: "btn btn-warning fw-bold py-2 shadow-sm" %>
      <div class="d-flex gap-2">
        <%= link_to 'Editar Perfil', edit_user_path(current_user), class: "btn btn-outline-light btn-sm flex-grow-1 py-2" %>
        <%= link_to messages_path, class: "btn btn-outline-warning btn-sm position-relative px-3" do %>
          <i class="bi bi-envelope"></i>
          <% if current_user.received_messages.where(read: false).any? %>
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
              <%= current_user.received_messages.where(read: false).count %>
            </span>
          <% end %>
        <% end %>
      </div>

    <% elsif user_signed_in? %>
      <%= link_to new_message_path(recipient_id: user.id), class: "btn btn-outline-warning fw-bold py-2 d-flex align-items-center justify-content-center gap-2" do %>
        <i class="bi bi-chat-dots"></i> Enviar mensaje
      <% end %>
    <% end %>
  </div>
</div>
